!include <font-awesome/common>
@startuml Rhodey Class Diagram
skinparam classAttributeIconSize 0
title Rhodey War Simulator
hide circle
skinparam linetype ortho

' ===== CLASSES =====

rectangle UI as UI {
    class UIView {
        - controller: UIController*
    }
    class UIController {
        - view: UIView*
        - model: Simluation*
    }
}
note bottom of UI #lightblue : USER INTERFACE

rectangle "AllianceGroups" {
    class Alliance {
        - members: vector<Country*>
    }

    ' class Conglomerate{
        ' - name: string
        ' + add(Conglomerate)*: void
        ' + print(): void
        ' + ~Conglomerate()
    ' }

    class Country {
        - sizeOfArmy: int
        - population: int
        - economy: double
        - morale: double
        - resolve: double
        - supplies: double
        - attrition: double
        - forces: Military
        - alliances: Alliance *
        - Allies: vector<Countries*>
        - trainingFacilitys: vector<TroopFactory*>
        - vehicleFactories: vector<VehicleFactory*>
    }

    class Region {
        - name: string
        - description: string
        - terrain: string
        - population: int
    }

    class Map {
        - regions : std::map<regionUUID, Region*>
    }
}



rectangle "War " as War {

    class Simulation {
        + Simulation()
        {static} - uniqueInstance: Simulation*
        # Simulation()
        #~Simulation()
        #Simulation(Simulation &)
        #=(Simulation &) : Simulation &
        - view: UIView*
        - war: War*
        - playerName: string
        ~Simulation()

    }

    class War{
        - participants: vector<Alliances*>
        - reasonForWar: string
        - reasonEndWar: string
        - battles: vector<Battle*>
        - state: WarPhases
        + request(): void
        + setState(phase: WarPhases): void
        + makeMemento():WarMemento
        + restoreBeforeState(WarMemento memento): void
    }



    class WarPhases {
        #war: War*
        + handle(): void
        {abstract} + changeState(): void
    }

    class Dispute {
        + handle(): void
        + changeState(): void
    }

    class Conflict {
        + handle(): void
        + changeState(): void
    }

    class Hostilities {
        + handle(): void
        + changeState(): void
    }

    class PostWar {
        + handle(): void
        + changeState(): void
    }

    class DisputeSettled {
        + handle(): void
        + changeState(): void
    }
    note bottom #lightgreen : STATE
}
note top of War #lightgreen : SINGLETON





rectangle Military {
    class Military {
        - BattleGroups: vector<Forces*>
        - Spies: vector<SpyAgency*>
        {abstract} + move(): void
        ~Military()
    }

    class Forces {
        - name: string
        - army: Army*
        - navy: Navy*
        - airforce: Airforce*
        - Region: Region*
        {abstract} + move(): void
        ~Military()
    }

    class Army {
        - name: string
        - numSoldiers: int
        - numCommanders: int
        - numTanks: int
        - numTrucks: int
        - units: vector<Entity*>
        + move(): void
        ~Army()
    }

    class Navy {
        - name: string
        - numCargoShips: int
        - numWarShips: int
        - numCarriers: int
        - numSubmarines: int
        - numFighters: int
        - units: vector<Entity*>
        + move(): void
        ~Navy()
    }

    class AirForce {
        - name: string
        - numFighters: int
        - numBombers: int
        - units: vector<Entity*>
        + move(): void
        ~AirForce()
    }

    rectangle Spies {

        class SpyAgency {
            # workFor: vector<Country*>
            # spyingOn: vector<Country*>
            # status: string
            + SpyAgency(spyingFor Country*, spyingOn Country*)
            + update(): void
            ~SpyAgency()
        }

        class Spy {
            {abstract} + update(): void
        }

    }
    note right #lightgreen : OBSERVER
}





'==== Factory method ===='
rectangle "Factories" {
    class UnitFactory{
        # name: string
        # hp: int
        # dmg: int
        + unitFactory()
        ~ unitFactory()
        + {abstract} makeUnit(): Entity*

    }

    class VehicleFactory {
        + VehicleFactory()
        ~ VehicleFactory()
        + makeUnit(): Entity*
    }

    class TroopFactory {
        + TroopFactory()
        ~ TruckFactory()
        + makeUnit(): Entity*
    }

    enum VehicleType {
        <<enumeration>>
        Truck
        Tank
        Carrier
        CargoShip
        Warship
        Submarine
        FighterJet
        Bomber
        CargoPlane
    }

    enum TroopType {
        <<enumeration>>
        Soldier
        Commander
        Spy
    }
}
note bottom #lightgreen : ABSTRACT FACTORY

class Battle {
    - country: Country*
    - Region: Region*
    - attackingForces: Forces**
    - defendingForces: Forces**
    + Battle(Forces~**, Forces~**, Region*, Country*)
    + start(): void
    + end(): void
    ~Battle()
}


'==== Entities ===='
rectangle "Entities" {

    class Entity {
        - name: string
        - hp: int
        - dmg: int
        - weapons: Weapon**
        + Entity()
        {abstract} + attack(): void
        {abstract} + defend(): void
        {abstract} + clone(): Entity
    }
    note bottom #lightgreen : PROTOTYPE

    class Vehicle {
        - capacity: int
        + Vehicle()
        {abstract} + attack(): void
        {abstract} + defend(): void
        {abstract} + clone(): Vehicle
    }

    class GroundVehicle {
        + GroundVehicle()
        {abstract} + attack(): void
        {abstract} + defend(): void
        {abstract} + clone(): GroundVehicle
    }

    class Truck {
        + Truck()
        + attack(): void
        + defend(): void
        + clone(): GroundVehicle
    }

    class Tank {
        + Tank()
        + attack(): void
        + defend(): void
        + clone(): GroundVehicle
    }

    class AirVehicle {
        + AirVehicle()
        {abstract} + attack(): void
        {abstract} + defend(): void
        {abstract} + clone(): AirVehicle
    }

    class FighterJet {
        + FighterJet()
        + attack(): void
        + defend(): void
        + clone(): AirVehicle
    }

    class Bomber {
        + Bomber()
        + attack(): void
        + defend(): void
        + clone(): AirVehicle
    }

    class CargoPlane {
        + CargoPlane()
        + attack(): void
        + defend(): void
        + clone(): AirVehicle
    }

    class WaterVehicle {
        + WaterVehicle()
        {abstract} + attack(): void
        {abstract} + defend(): void
        {abstract} + clone(): WaterVehicle
    }

    class CargoShip {
        + CargoShip()
        + attack(): void
        + defend(): void
        + clone(): WaterVehicle
    }

    class Warship {
        + Warship()
        + attack(): void
        + defend(): void
        + clone(): WaterVehicle
    }

    class Submarine {
        + Submarine()
        + attack(): void
        + defend(): void
        + clone(): WaterVehicle
    }

    class Carrier {
        + Carrier()
        + attack(): void
        + defend(): void
        + clone(): WaterVehicle
    }

    class Troop {
        + Troop()
        {abstract} + attack(): void
        {abstract} + defend(): void
        {abstract} + clone(): Troop
    }

    class Soldier {
        + Soldier()
        + attack(): void
        + defend(): void
        + clone(): Troop
    }

    class Commander {
        + Commander()
        + attack(): void
        + defend(): void
        + command(): void
        + clone(): Troop
    }

    class Weapon {
        - weaponName: string
        - dmg: int
    }
}
note bottom #lightgreen : TEMPLATE METHOD


'==== Different strategy states ===='
rectangle "Strategy States" as StratStates {
    class BattleStrategy {
        {abstract} + warAlgorithm()
    }

    class DefensiveStrategy {
        + warAlgorithm()
        + redistributeTroops(): void
        + recruitTroops(): void
    }
    
    class OffensiveStrategy {
        + warAlgorithm()
        + redistributeTroops(): void
        + recruitTroops(): void
        + attack(): void
        + spy(): void
    }

    class ResearchiveStrategy {
        + warAlgorithm()
        + ResearchAndDevelop(): void
        + buildVehicles(): void
        + buildWeapons(): void
        + spy(): void
    }

    class PrepareStrategy {
        + warAlgorithm()
        + redistributeTroops(): void
        + recruitTroops(): void
        + buildVehicles(): void
        + buildWeapons(): void
        + spy(): void
    }

    class DiplomacyStrategy{
        + warAlgorithm()
        + proposeTreaty(): void
        + surrender(): void
    }
}
note right of StratStates #lightgreen : STRATEGY




rectangle "Mementos" as Mementos {
    class WarMemento{
        +getState()
        -state: WarState*
        ~Memento():virtual
    }
    class caretaker {
        - warStates: vector<WarMemento>
        + add(memento WarMemento):void

    }

    class WarState {

        - Vector<String>
        - WarState(War* war)
    }
}
note top of Mementos #lightgreen : MEMENTO

' ===== RELATIONSHIPS =====
Simulation o- War
Simulation o- Simulation

Entity o- Weapon
Entity <|-- Troop
Entity <|-- Vehicle
Troop <|-- Soldier
Troop <|-- Commander
Vehicle <|-- GroundVehicle
Vehicle <|-- AirVehicle
Vehicle <|-- WaterVehicle
GroundVehicle <|-- Truck
GroundVehicle <|-- Tank
AirVehicle <|-- FighterJet
AirVehicle <|-- Bomber
AirVehicle <|-- CargoPlane
WaterVehicle <|-- CargoShip
WaterVehicle <|-- Warship
WaterVehicle <|-- Submarine
WaterVehicle <|-- Carrier



VehicleFactory ..> Truck : <<instantiates>>
VehicleFactory ..> Tank : <<instantiates>>
VehicleFactory ..> Warship : <<instantiates>>
VehicleFactory ..> Submarine : <<instantiates>>
VehicleFactory ..> Carrier : <<instantiates>>
VehicleFactory ..> CargoShip : <<instantiates>>
VehicleFactory ..> Bomber : <<instantiates>>
VehicleFactory ..> CargoPlane : <<instantiates>>
TroopFactory   ..> Soldier : <<instantiates>>
TroopFactory   ..> Commander : <<instantiates>>

War ..> WarMemento
caretaker o-- WarMemento
WarMemento o-- WarState

Forces o-- Army
Forces o-- Navy
Forces o-- AirForce

Military o-- Forces

Army o-- Entity
Navy o-- Entity
AirForce o-- Entity

Country *-- Military
Country o-- VehicleFactory
Country o-- TroopFactory

Battle o-- Country

SpyAgency <|-- Spy
Military o-- SpyAgency

Alliance <|-- Country
War o-- Alliance
BattleStrategy o-- Country
DefensiveStrategy <|-- BattleStrategy
OffensiveStrategy <|-- BattleStrategy
ResearchiveStrategy <|-- BattleStrategy
PrepareStrategy <|-- BattleStrategy
DiplomacyStrategy <|-- BattleStrategy

Dispute <|-- WarPhases
Conflict <|-- WarPhases
Hostilities <|-- WarPhases
PostWar <|-- WarPhases
DisputeSettled <|-- WarPhases

War o-l- WarPhases
WarPhases o- War
War o-- Battle

War o-- Map
Map o-- Region
Region o-- Country
Region o-- Forces
Battle o-- Region
' UI Model View Controller
UIView -u-o UIController
UIController -d-o UIView
UIController -r-o Simulation
Simulation -r-o UIView

@enduml